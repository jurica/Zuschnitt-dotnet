@using Zuschnitt.Models;

@inject AppState AppState
@inject NavigationManager NavigationManager
@inject IJSRuntime JsRuntime

<FluentButton Id="@_id" IconStart="@(new Icons.Regular.Size20.LineHorizontal3())" OnClick="() => _showMenu = !_showMenu"/>
<FluentMenu @bind-Open="_showMenu" Anchor="@_id" VerticalThreshold="100">
    <ActionMenuItem Icon="@(new Icons.Regular.Size20.Document())" OnClick="OpenFile" Text="Load"/>
    <ActionMenuItem Icon="@(new Icons.Regular.Size20.Save())" OnClick="SaveAs" Text="Save"/>
</FluentMenu>

@code {
    [Parameter] public Column? Column { get; set; }

    private bool _showMenu = false;
    private string _id = Guid.NewGuid().ToString();

    private void OpenFile()
    {
        _showMenu = false;
        NavigationManager.NavigateTo("openfile");
    }

    private void SaveAs()
    {
        _showMenu = false;
        string filename = "Zuschnitt";
        if (!string.IsNullOrEmpty(AppState.Project.Name)) filename = AppState.Project.Name;
        filename += ".zsn";
        
        JsRuntime.InvokeAsync<object>(
            "saveAsFile",
            filename,
            Convert.ToBase64String(AppState.Project.Serialize()));
    }
}